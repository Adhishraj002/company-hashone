<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Hashone Careers</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>
<body>
    <nav class="admin-navbar">
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    <img src="images/logo2.jpg" alt="Hashone Careers Logo">
                </a>
            </div>
            <div class="admin-user">
                <div class="admin-user-info">
                    <div class="admin-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <span id="adminUsername">Admin</span>
                </div>
                <button class="logout-btn" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="admin-content">
        <div class="container">
            <div class="admin-header" data-aos="fade-up">
                <h1>Admin Dashboard</h1>
                <p>Manage job roles and company listings</p>
            </div>

            <div class="admin-stats" data-aos="fade-up" data-aos-delay="100">
                <div class="stat-card">
                    <i class="fas fa-briefcase"></i>
                    <h3 id="totalJobs">0</h3>
                    <p>Total Jobs</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3 id="totalTeamMembers">0</h3>
                    <p>Team Members</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-building"></i>
                    <h3 id="totalServices">4</h3>
                    <p>Services</p>
                </div>
            </div>

            <!-- Admin Tabs -->
            <div class="admin-panel" data-aos="fade-up" data-aos-delay="200">
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchTab('jobs', this)">
                        <i class="fas fa-briefcase"></i> Job Roles
                    </button>
                    <button class="admin-tab" onclick="switchTab('home', this)">
                        <i class="fas fa-home"></i> Home Page
                    </button>
                    <button class="admin-tab" onclick="switchTab('about', this)">
                        <i class="fas fa-info-circle"></i> About Us
                    </button>
                    <button class="admin-tab" onclick="switchTab('services', this)">
                        <i class="fas fa-cogs"></i> Services
                    </button>
                    <button class="admin-tab" onclick="switchTab('contact', this)">
                        <i class="fas fa-address-book"></i> Contact
                    </button>
                    <button class="admin-tab" onclick="switchTab('team', this)">
                        <i class="fas fa-users"></i> Team Members
                    </button>
                </div>

            <!-- Jobs Tab -->
            <div id="jobsTab" class="tab-content active">
                <div class="panel-header">
                    <h2>
                        <i class="fas fa-plus-circle"></i>
                        <span id="panelTitle">Add New Job Role</span>
                    </h2>
                    <button class="add-job-btn" id="addJobBtn" onclick="showAddForm()">
                        <i class="fas fa-plus"></i> Add Job
                    </button>
                </div>

                <form id="jobForm" class="admin-form admin-form-hidden">
                    <input type="hidden" id="jobId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jobTitle">Job Title *</label>
                            <input type="text" id="jobTitle" required placeholder="e.g., Frontend Developer">
                        </div>
                        <div class="form-group">
                            <label for="jobLocation">Location *</label>
                            <input type="text" id="jobLocation" required placeholder="e.g., Coimbatore">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="jobExperience">Experience *</label>
                            <input type="text" id="jobExperience" required placeholder="e.g., 1-3 Years">
                        </div>
                        <div class="form-group">
                            <label for="jobType">Employment Type *</label>
                            <input type="text" id="jobType" required placeholder="e.g., Full-Time">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="jobDescription">Description *</label>
                        <textarea id="jobDescription" rows="4" required placeholder="Job description..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="jobFormUrl">Application Form URL *</label>
                        <input type="url" id="jobFormUrl" required placeholder="https://forms.google.com/...">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Job
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>

            <div class="jobs-list" data-aos="fade-up" data-aos-delay="300">
                <h3>
                    <i class="fas fa-list"></i>
                    Current Job Listings
                </h3>
                <div class="jobs-grid" id="jobsGrid">
                    <!-- Jobs will be loaded here -->
                </div>
            </div>
            </div>

            <!-- Home Tab -->
            <div id="homeTab" class="tab-content">
                <div class="panel-header">
                    <h2><i class="fas fa-home"></i> Home Page Content</h2>
                </div>
                <form id="homeForm" class="admin-form">
                    <div class="form-group">
                        <label for="heroTitle">Hero Title</label>
                        <input type="text" id="heroTitle" placeholder="Building Careers. Powering Businesses.">
                    </div>
                    <div class="form-group">
                        <label for="heroSubtitle">Hero Subtitle</label>
                        <input type="text" id="heroSubtitle" placeholder="Trusted recruitment partner for IT & Non-IT hiring solutions">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="statClients">Happy Clients Count</label>
                            <input type="number" id="statClients" placeholder="80">
                        </div>
                        <div class="form-group">
                            <label for="statPlacements">Placements Count</label>
                            <input type="number" id="statPlacements" placeholder="500">
                        </div>
                        <div class="form-group">
                            <label for="statExperience">Years Experience</label>
                            <input type="number" id="statExperience" placeholder="4">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Home Content</button>
                    </div>
                </form>
            </div>

            <!-- About Tab -->
            <div id="aboutTab" class="tab-content">
                <div class="panel-header">
                    <h2><i class="fas fa-info-circle"></i> About Us Content</h2>
                </div>
                <form id="aboutForm" class="admin-form">
                    <div class="form-group">
                        <label for="aboutEstablished">Established Date</label>
                        <input type="text" id="aboutEstablished" placeholder="September 22, 2021">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="aboutTeamCount">Team Members Count</label>
                            <input type="number" id="aboutTeamCount" placeholder="52">
                        </div>
                        <div class="form-group">
                            <label for="aboutClientsCount">Clients Count</label>
                            <input type="number" id="aboutClientsCount" placeholder="80">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="aboutMission">Mission Statement</label>
                        <textarea id="aboutMission" rows="4" placeholder="We simplify the business employment process..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Leadership (Founder &amp; Co-Founder)</label>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="founder1Name">Founder 1 Name</label>
                                <input type="text" id="founder1Name" placeholder="M Mohamed Arif">
                            </div>
                            <div class="form-group">
                                <label for="founder1Role">Founder 1 Role</label>
                                <input type="text" id="founder1Role" placeholder="Founder">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Founder 1 Photo</label>
                            <div class="image-upload-container">
                                <img id="founder1PhotoPreview" class="image-preview" alt="Founder 1 preview">
                                <div class="file-input-wrapper">
                                    <label for="founder1PhotoInput" class="file-input-label">
                                        <i class="fas fa-upload"></i> Upload Founder 1 Photo
                                    </label>
                                    <input type="file" id="founder1PhotoInput" accept="image/*" onchange="previewFounderPhoto(event, 1)">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="founder1Bio">Founder 1 Bio</label>
                            <textarea id="founder1Bio" rows="2" placeholder="Visionary leader..."></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="founder2Name">Founder 2 Name</label>
                                <input type="text" id="founder2Name" placeholder="M Mohamed Asif">
                            </div>
                            <div class="form-group">
                                <label for="founder2Role">Founder 2 Role</label>
                                <input type="text" id="founder2Role" placeholder="Co-Founder">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Founder 2 Photo</label>
                            <div class="image-upload-container">
                                <img id="founder2PhotoPreview" class="image-preview" alt="Founder 2 preview">
                                <div class="file-input-wrapper">
                                    <label for="founder2PhotoInput" class="file-input-label">
                                        <i class="fas fa-upload"></i> Upload Founder 2 Photo
                                    </label>
                                    <input type="file" id="founder2PhotoInput" accept="image/*" onchange="previewFounderPhoto(event, 2)">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="founder2Bio">Founder 2 Bio</label>
                            <textarea id="founder2Bio" rows="2" placeholder="Strategic partner..."></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save About Content</button>
                    </div>
                </form>
            </div>

            <!-- Services Tab -->
            <div id="servicesTab" class="tab-content">
                <div class="panel-header">
                    <h2><i class="fas fa-cogs"></i> Services Content</h2>
                </div>
                <div id="servicesList">
                    <!-- Services will be loaded here -->
                </div>
            </div>

            <!-- Contact Tab -->
            <div id="contactTab" class="tab-content">
                <div class="panel-header">
                    <h2><i class="fas fa-address-book"></i> Contact Information</h2>
                </div>
                <form id="contactForm" class="admin-form">
                    <div class="form-group">
                        <label for="contactAddress">Office Address</label>
                        <textarea id="contactAddress" rows="4" placeholder="Hashone Careers Pvt Ltd..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactPhone">Phone</label>
                            <input type="text" id="contactPhone" placeholder="+91 9789288938">
                        </div>
                        <div class="form-group">
                            <label for="contactEmail">Email</label>
                            <input type="email" id="contactEmail" placeholder="info@hashone.co.in">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactHours">Office Hours</label>
                            <input type="text" id="contactHours" placeholder="Monday - Friday, 9:00 AM - 6:00 PM">
                        </div>
                        <div class="form-group">
                            <label for="contactGST">GST Number</label>
                            <input type="text" id="contactGST" placeholder="33AAGCH0304M1ZW">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactLinkedIn">LinkedIn URL</label>
                            <input type="url" id="contactLinkedIn" placeholder="https://linkedin.com/...">
                        </div>
                        <div class="form-group">
                            <label for="contactInstagram">Instagram URL</label>
                            <input type="url" id="contactInstagram" placeholder="https://instagram.com/...">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Contact Info</button>
                    </div>
                </form>
            </div>

            <!-- Team Members Tab -->
            <div id="teamTab" class="tab-content">
                <div class="panel-header">
                    <h2><i class="fas fa-users"></i> Team Members</h2>
                    <button class="add-job-btn" onclick="showAddTeamForm()">
                        <i class="fas fa-plus"></i> Add Team Member
                    </button>
                </div>
                <form id="teamForm" class="admin-form admin-form-hidden">
                    <input type="hidden" id="teamMemberId">
                    <div class="form-group">
                        <label>Member Photo</label>
                        <div class="image-upload-container">
                            <img id="teamPhotoPreview" class="image-preview" alt="Preview">
                            <div class="file-input-wrapper">
                                <label for="teamPhoto" class="file-input-label">
                                    <i class="fas fa-upload"></i> Upload Photo
                                </label>
                                <input type="file" id="teamPhoto" accept="image/*" onchange="previewTeamPhoto(event)">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="teamName">Name *</label>
                            <input type="text" id="teamName" required placeholder="John Doe">
                        </div>
                        <div class="form-group">
                            <label for="teamRole">Role *</label>
                            <input type="text" id="teamRole" required placeholder="Senior Developer">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="teamBio">Bio</label>
                        <textarea id="teamBio" rows="3" placeholder="Brief description..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Member</button>
                        <button type="button" class="btn btn-secondary" onclick="resetTeamForm()"><i class="fas fa-times"></i> Cancel</button>
                    </div>
                </form>
                <div id="teamMembersList" class="admin-team-list">
                    <!-- Team members will be loaded here -->
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script src="config.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        var API_BASE = (typeof window !== "undefined" && window.API_BASE_URL) ? window.API_BASE_URL : "https://company-hashone.onrender.com";

        // Redirect only if no token; otherwise show dashboard and verify in background
        var token = localStorage.getItem("adminToken");
        if (!token) {
            window.location.href = "login.html";
        } else {
            document.getElementById("adminUsername").textContent = "Admin";
            // Verify token in background so dashboard shows immediately
            fetch(API_BASE + "/api/admin/me", { headers: { "Authorization": "Bearer " + token } })
                .then(function(res) {
                    if (!res.ok) {
                        localStorage.removeItem("adminToken");
                        window.location.href = "login.html";
                    }
                })
                .catch(function() {
                    // Backend may be offline; keep user on page, they can retry
                    console.warn("Could not verify token. Ensure backend is running.");
                });
        }

        if (typeof AOS !== "undefined") AOS.init({ duration: 400, once: true, offset: 0 });



        // Tab switching
        function switchTab(tabName, element) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.admin-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            if (element) {
                element.classList.add('active');
            } else {
                document.querySelector(`.admin-tab[onclick*="${tabName}"]`).classList.add('active');
            }

            // Load tab-specific data
            if (tabName === 'team') {
                loadTeamMembers();
            } else if (tabName === 'services') {
                loadServices();
            } else if (tabName === 'home') {
                loadHomeContent();
            } else if (tabName === 'about') {
                loadAboutContent();
            } else if (tabName === 'contact') {
                loadContactContent();
            }
        }

        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Job management functions
        let jobs = [];
        let teamMembers = [];
        let websiteContent = {
            home: {},
            about: {},
            services: [],
            contact: {}
        };

        // Leadership photo previews (About tab)
        function previewFounderPhoto(event, which) {
            const file = event.target.files && event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                const img = document.getElementById(which === 1 ? 'founder1PhotoPreview' : 'founder2PhotoPreview');
                if (img) {
                    img.src = base64;
                    img.classList.add('show');
                }
            };
            reader.readAsDataURL(file);
        }

  
        function loadJobs() {
            fetch(API_BASE + "/api/jobs")
            .then(res => res.json())
            .then(data => {
                jobs = data;
                renderJobs();
                updateStats();
            })
            .catch(err => console.error("Failed to load jobs", err));
        }


        function renderJobs() {
            const jobsGrid = document.getElementById('jobsGrid');
            if (!jobsGrid) return;

            if (jobs.length === 0) {
                jobsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-inbox"></i>
                        <p>No job listings yet. Click "Add Job" to create your first listing.</p>
                    </div>
                `;
                return;
            }

            jobsGrid.innerHTML = '';
            jobs.forEach(job => {
                const jobCard = document.createElement('div');
                jobCard.className = 'job-card-admin';
                jobCard.innerHTML = `
                    <div class="job-title">${job.title}</div>
                    <div class="job-meta">
                        <span><i class="fas fa-map-marker-alt"></i> ${job.location}</span>
                        <span><i class="fas fa-briefcase"></i> ${job.experience}</span>
                        <span><i class="fas fa-clock"></i> ${job.type}</span>
                    </div>
                    <div class="job-description">${job.description}</div>
                    <div class="job-actions">
                        <button class="btn-edit-admin" onclick="editJob(${job.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn-delete-admin" onclick="deleteJob(${job.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                jobsGrid.appendChild(jobCard);
            });
        }

        function updateStats() {
            document.getElementById('totalJobs').textContent = jobs.length;
            document.getElementById('totalTeamMembers').textContent = teamMembers.length;
            // Animate count up
            animateCountUp('totalJobs', jobs.length);
            animateCountUp('totalTeamMembers', teamMembers.length);
        }

        function animateCountUp(elementId, target) {
            const element = document.getElementById(elementId);
            let current = 0;
            const increment = target / 50;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    element.textContent = target;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 30);
        }

        function showAddForm() {
            const form = document.getElementById('jobForm');
            const panelTitle = document.getElementById('panelTitle');
            const addBtn = document.getElementById('addJobBtn');
            
            resetForm();
            form.classList.remove('admin-form-hidden');
            form.classList.add('admin-form-visible');
            panelTitle.textContent = 'Add New Job Role';
            addBtn.classList.add('admin-btn-hidden');
            form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetForm() {
            document.getElementById('jobForm').reset();
            document.getElementById('jobId').value = '';
            const form = document.getElementById('jobForm');
            const panelTitle = document.getElementById('panelTitle');
            const addBtn = document.getElementById('addJobBtn');
            
            form.classList.add('admin-form-hidden');
            form.classList.remove('admin-form-visible');
            panelTitle.textContent = 'Manage Job Roles';
            addBtn.classList.remove('admin-btn-hidden');
        }

        function editJob(id) {
            const job = jobs.find(j => j.id === id);
            if (job) {
                document.getElementById('jobId').value = job.id;
                document.getElementById('jobTitle').value = job.title;
                document.getElementById('jobLocation').value = job.location;
                document.getElementById('jobExperience').value = job.experience;
                document.getElementById('jobType').value = job.type;
                document.getElementById('jobDescription').value = job.description;
                document.getElementById('jobFormUrl').value = job.formUrl;

                const form = document.getElementById('jobForm');
                const panelTitle = document.getElementById('panelTitle');
                const addBtn = document.getElementById('addJobBtn');
                
                form.classList.remove('admin-form-hidden');
                form.classList.add('admin-form-visible');
                panelTitle.textContent = 'Edit Job Role';
                addBtn.classList.add('admin-btn-hidden');
                form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        function deleteJob(id) {
            if (!confirm("Are you sure you want to delete this job posting?")) return;

            fetch(API_BASE + "/api/jobs/" + id, {
                method: "DELETE",
                headers: { "Authorization": "Bearer " + localStorage.getItem("adminToken") }
            })
            .then(() => {
                loadJobs();
                showNotification("Job deleted successfully");
            })
            .catch(() => {
                showNotification("Delete failed", "error");
            });
        }


        function handleLogout() {
            localStorage.removeItem("adminToken");
            window.location.href = "login.html";
        }


        // Form submission
        document.getElementById('jobForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const jobId = document.getElementById('jobId').value;
            const jobData = {
                title: document.getElementById('jobTitle').value,
                location: document.getElementById('jobLocation').value,
                experience: document.getElementById('jobExperience').value,
                type: document.getElementById('jobType').value,
                description: document.getElementById('jobDescription').value,
                formUrl: document.getElementById('jobFormUrl').value
            };

            const method = jobId ? "PUT" : "POST";
            const url = jobId ? API_BASE + "/api/jobs/" + jobId : API_BASE + "/api/jobs";
            fetch(url, {
                method,
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + localStorage.getItem("adminToken")
                },
                body: JSON.stringify(jobData)
            })
            .then(res => {
                if (!res.ok) throw new Error("Save failed");
                return res.json();
            })
            .then(() => {
                resetForm();
                loadJobs();
                showNotification("Job saved successfully!");
            })
            .catch(err => {
                showNotification("Job NOT saved (auth or server error)", "error");
                console.error(err);
            })
            });

        // Team Members (from backend)
        function loadTeamMembers() {
            fetch(API_BASE + "/api/team-members", { headers: {} })
                .then(res => res.json())
                .then(data => {
                    teamMembers = data || [];
                    renderTeamMembers();
                    updateStats();
                })
                .catch(() => { teamMembers = []; renderTeamMembers(); updateStats(); });
        }

        function renderTeamMembers() {
            const container = document.getElementById('teamMembersList');
            if (!container) return;

            if (teamMembers.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><p>No team members yet. Click "Add Team Member" to add one.</p></div>';
                return;
            }

            container.innerHTML = '';
            teamMembers.forEach(member => {
                const card = document.createElement('div');
                card.className = 'team-member-card';
                card.innerHTML = `
                    ${member.photo ? `<img src="${member.photo}" alt="${member.name}">` : '<div class="team-avatar"><i class="fas fa-user"></i></div>'}
                    <h4>${member.name}</h4>
                    <p><strong>${member.role}</strong></p>
                    ${member.bio ? `<p>${member.bio}</p>` : ''}
                    <div class="job-actions">
                        <button class="btn-edit-admin" onclick="editTeamMember(${member.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn-delete-admin" onclick="deleteTeamMember(${member.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function previewTeamPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('teamPhotoPreview').src = e.target.result;
                    document.getElementById('teamPhotoPreview').classList.add('show');
                };
                reader.readAsDataURL(file);
            }
        }

        function showAddTeamForm() {
            document.getElementById('teamForm').classList.remove('admin-form-hidden');
            document.getElementById('teamForm').classList.add('admin-form-visible');
            resetTeamForm();
        }

        function resetTeamForm() {
            document.getElementById('teamForm').reset();
            document.getElementById('teamMemberId').value = '';
            document.getElementById('teamPhotoPreview').classList.remove('show');
        }

        function editTeamMember(id) {
            const member = teamMembers.find(m => m.id === id);
            if (member) {
                document.getElementById('teamMemberId').value = member.id;
                document.getElementById('teamName').value = member.name;
                document.getElementById('teamRole').value = member.role;
                document.getElementById('teamBio').value = member.bio || '';
                if (member.photo) {
                    document.getElementById('teamPhotoPreview').src = member.photo;
                    document.getElementById('teamPhotoPreview').classList.add('show');
                }
                document.getElementById('teamForm').classList.remove('admin-form-hidden');
                document.getElementById('teamForm').classList.add('admin-form-visible');
                document.getElementById('teamForm').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function deleteTeamMember(id) {
            if (!confirm('Are you sure you want to delete this team member?')) return;
            fetch(API_BASE + "/api/team-members/" + id, {
                method: "DELETE",
                headers: { "Authorization": "Bearer " + localStorage.getItem("adminToken") }
            })
            .then(res => {
                if (!res.ok) throw new Error("Delete failed");
                loadTeamMembers();
                showNotification('Team member deleted successfully');
            })
            .catch(() => showNotification('Delete failed', 'error'));
        }

        // Content (from backend)
        function loadHomeContent() {
            fetch(API_BASE + "/api/site-content").then(r => r.json()).then(sections => {
                const home = sections.home || {};
                document.getElementById('heroTitle').value = home.heroTitle || '';
                document.getElementById('heroSubtitle').value = home.heroSubtitle || '';
                document.getElementById('statClients').value = home.statClients ?? '';
                document.getElementById('statPlacements').value = home.statPlacements ?? '';
                document.getElementById('statExperience').value = home.statExperience ?? '';
            }).catch(() => {});
        }

        function loadAboutContent() {
            fetch(API_BASE + "/api/site-content").then(r => r.json()).then(sections => {
                const about = sections.about || {};
                document.getElementById('aboutEstablished').value = about.established || '';
                document.getElementById('aboutTeamCount').value = about.teamCount ?? '';
                document.getElementById('aboutClientsCount').value = about.clientsCount ?? '';
                document.getElementById('aboutMission').value = about.mission || '';
                document.getElementById('founder1Name').value = about.founder1Name || '';
                document.getElementById('founder1Role').value = about.founder1Role || '';
                document.getElementById('founder1Bio').value = about.founder1Bio || '';
                document.getElementById('founder2Name').value = about.founder2Name || '';
                document.getElementById('founder2Role').value = about.founder2Role || '';
                document.getElementById('founder2Bio').value = about.founder2Bio || '';
                const f1Prev = document.getElementById('founder1PhotoPreview');
                const f2Prev = document.getElementById('founder2PhotoPreview');
                if (f1Prev && about.founder1Photo) { f1Prev.src = about.founder1Photo; f1Prev.classList.add('show'); }
                if (f2Prev && about.founder2Photo) { f2Prev.src = about.founder2Photo; f2Prev.classList.add('show'); }
            }).catch(() => {});
        }

        function loadContactContent() {
            fetch(API_BASE + "/api/site-content").then(r => r.json()).then(sections => {
                const contact = sections.contact || {};
                document.getElementById('contactAddress').value = contact.address || '';
                document.getElementById('contactPhone').value = contact.phone || '';
                document.getElementById('contactEmail').value = contact.email || '';
                document.getElementById('contactHours').value = contact.hours || '';
                document.getElementById('contactGST').value = contact.gst || '';
                document.getElementById('contactLinkedIn').value = contact.linkedin || '';
                document.getElementById('contactInstagram').value = contact.instagram || '';
            }).catch(() => {});
        }

        function loadServices() {
            const container = document.getElementById('servicesList');
            container.innerHTML = '<p style="color: var(--text-light);">Services content is managed in the main site. Editable services can be added later.</p>';
        }

        function saveSiteContent(section, data) {
            return fetch(API_BASE + "/api/site-content", {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + localStorage.getItem("adminToken")
                },
                body: JSON.stringify({ section: section, data: data })
            });
        }

        document.getElementById('homeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = {
                heroTitle: document.getElementById('heroTitle').value,
                heroSubtitle: document.getElementById('heroSubtitle').value,
                statClients: document.getElementById('statClients').value,
                statPlacements: document.getElementById('statPlacements').value,
                statExperience: document.getElementById('statExperience').value
            };
            saveSiteContent('home', data).then(res => {
                if (res.ok) showNotification('Home content saved!');
                else showNotification('Save failed', 'error');
            }).catch(() => showNotification('Save failed', 'error'));
        });

        document.getElementById('aboutForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const aboutDraft = {
                established: document.getElementById('aboutEstablished').value,
                teamCount: document.getElementById('aboutTeamCount').value,
                clientsCount: document.getElementById('aboutClientsCount').value,
                mission: document.getElementById('aboutMission').value,
                founder1Name: document.getElementById('founder1Name').value,
                founder1Role: document.getElementById('founder1Role').value,
                founder1Bio: document.getElementById('founder1Bio').value,
                founder2Name: document.getElementById('founder2Name').value,
                founder2Role: document.getElementById('founder2Role').value,
                founder2Bio: document.getElementById('founder2Bio').value,
                founder1Photo: (function(){ var s = document.getElementById('founder1PhotoPreview').src || ''; return s.indexOf('data:') === 0 ? s : ''; })(),
                founder2Photo: (function(){ var s = document.getElementById('founder2PhotoPreview').src || ''; return s.indexOf('data:') === 0 ? s : ''; })()
            };
            const f1Input = document.getElementById('founder1PhotoInput');
            const f2Input = document.getElementById('founder2PhotoInput');
            const readFileAsBase64 = (file) => new Promise((resolve) => {
                if (!file) return resolve('');
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.readAsDataURL(file);
            });
            Promise.all([
                readFileAsBase64(f1Input && f1Input.files && f1Input.files[0] ? f1Input.files[0] : null),
                readFileAsBase64(f2Input && f2Input.files && f2Input.files[0] ? f2Input.files[0] : null)
            ]).then(([f1b64, f2b64]) => {
                if (f1b64) aboutDraft.founder1Photo = f1b64;
                if (f2b64) aboutDraft.founder2Photo = f2b64;
                saveSiteContent('about', aboutDraft).then(res => {
                    if (res.ok) showNotification('About content saved!');
                    else showNotification('Save failed', 'error');
                }).catch(() => showNotification('Save failed', 'error'));
            });
        });

        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = {
                address: document.getElementById('contactAddress').value,
                phone: document.getElementById('contactPhone').value,
                email: document.getElementById('contactEmail').value,
                hours: document.getElementById('contactHours').value,
                gst: document.getElementById('contactGST').value,
                linkedin: document.getElementById('contactLinkedIn').value,
                instagram: document.getElementById('contactInstagram').value
            };
            saveSiteContent('contact', data).then(res => {
                if (res.ok) showNotification('Contact info saved!');
                else showNotification('Save failed', 'error');
            }).catch(() => showNotification('Save failed', 'error'));
        });

        document.getElementById('teamForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const fileInput = document.getElementById('teamPhoto');
            let photoBase64 = '';
            
            if (fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoBase64 = e.target.result;
                    saveTeamMember(photoBase64);
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                const existingMember = teamMembers.find(m => m.id === parseInt(document.getElementById('teamMemberId').value));
                photoBase64 = existingMember ? existingMember.photo : '';
                saveTeamMember(photoBase64);
            }
        });

        function saveTeamMember(photoBase64) {
            const memberId = document.getElementById('teamMemberId').value;
            const memberData = {
                name: document.getElementById('teamName').value,
                role: document.getElementById('teamRole').value,
                bio: document.getElementById('teamBio').value,
                photo: photoBase64 || ''
            };

            if (memberId) {
                fetch(API_BASE + "/api/team-members/" + memberId, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + localStorage.getItem("adminToken")
                    },
                    body: JSON.stringify(memberData)
                })
                .then(res => {
                    if (!res.ok) throw new Error();
                    loadTeamMembers();
resetTeamForm();
            document.getElementById('teamForm').classList.add('admin-form-hidden');
            document.getElementById('teamForm').classList.remove('admin-form-visible');
            showNotification('Team member updated!');
                })
                .catch(() => showNotification('Update failed', 'error'));
            } else {
                fetch(API_BASE + "/api/team-members", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + localStorage.getItem("adminToken")
                    },
                    body: JSON.stringify(memberData)
                })
                .then(res => res.json())
                .then(() => {
                    loadTeamMembers();
                    resetTeamForm();
                    document.getElementById('teamForm').classList.add('admin-form-hidden');
                    document.getElementById('teamForm').classList.remove('admin-form-visible');
                    showNotification('Team member added!');
                })
                .catch(() => showNotification('Add failed', 'error'));
            }
        }

        // Load jobs on page load
        loadJobs();
        loadTeamMembers();
    </script>
</body>
</html>
